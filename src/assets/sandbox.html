<script>
    window.addEventListener('message', function(e) {
        const {javascript, html, css} = e.data || {};
        if (html) {
            document.documentElement.innerHTML = html;
        }
        if (css) {
            const style = document.createElement('style');
            style.type = 'text/css';
            style.innerHTML = css;
            document.head.appendChild(style);
        }
        if (javascript) {
            Function(javascript)();
        }
    });
    window.parent.postMessage('sandbox-ready', '*');
    {
        const log = (type, msg, otherArgs) => {
            try {
                window.parent.postMessage({msg, otherArgs, type}, '*');
            } catch (er) {
                try {
                    window.parent.postMessage({msg: msg.toString(), otherArgs, type}, '*');
                } catch (er) { // Don't let it be handled by us
                    _console.error(er);
                }
            }
            if (otherArgs) {
                _console[type].call(_console, [msg, ...otherArgs]);
            } else {
                _console[type](msg);
            }
        };
        const _console = window.console;
        window.console = ['log','warn','error'].reduce((acc, type) => {
            acc[type] = (msg, ...rest) => log(type, msg, !!rest.length && rest);
            return acc;
        }, {});
        window.addEventListener('error', ({error}) => {
            let msg = error.stack;
            if (msg) {
                msg = msg.replace(/eval at <anon.+?nymous>:/g, '').replace(RegExp('(at )?'+location.href.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')+'[:\\d]+'),'').replace('eval ','');
            } else {
                msg = error.toString();
            }
            log('error', msg);
        });
    }
</script>