import * as monaco from "monaco-editor/esm/vs/editor/editor.api";
import { JSInterpreter } from "./debugger";

const pairs: Array<[string, string[], Partial<monaco.Token>[][], object]> = [
    [
        'test',
        ["var x = 3;","let y = 4;","const z = 5;","console.log(x, y, z);"],
        [[{"offset":0,"type":"keyword.js","language":"javascript"},{"offset":3,"type":"","language":"javascript"},{"offset":4,"type":"identifier.js","language":"javascript"},{"offset":5,"type":"","language":"javascript"},{"offset":6,"type":"delimiter.js","language":"javascript"},{"offset":7,"type":"","language":"javascript"},{"offset":8,"type":"number.js","language":"javascript"},{"offset":9,"type":"delimiter.js","language":"javascript"}],[{"offset":0,"type":"keyword.js","language":"javascript"},{"offset":3,"type":"","language":"javascript"},{"offset":4,"type":"identifier.js","language":"javascript"},{"offset":5,"type":"","language":"javascript"},{"offset":6,"type":"delimiter.js","language":"javascript"},{"offset":7,"type":"","language":"javascript"},{"offset":8,"type":"number.js","language":"javascript"},{"offset":9,"type":"delimiter.js","language":"javascript"}],[{"offset":0,"type":"keyword.js","language":"javascript"},{"offset":5,"type":"","language":"javascript"},{"offset":6,"type":"identifier.js","language":"javascript"},{"offset":7,"type":"","language":"javascript"},{"offset":8,"type":"delimiter.js","language":"javascript"},{"offset":9,"type":"","language":"javascript"},{"offset":10,"type":"number.js","language":"javascript"},{"offset":11,"type":"delimiter.js","language":"javascript"}],[{"offset":0,"type":"identifier.js","language":"javascript"},{"offset":7,"type":"delimiter.js","language":"javascript"},{"offset":8,"type":"identifier.js","language":"javascript"},{"offset":11,"type":"delimiter.parenthesis.js","language":"javascript"},{"offset":12,"type":"identifier.js","language":"javascript"},{"offset":13,"type":"delimiter.js","language":"javascript"},{"offset":14,"type":"","language":"javascript"},{"offset":15,"type":"identifier.js","language":"javascript"},{"offset":16,"type":"delimiter.js","language":"javascript"},{"offset":17,"type":"","language":"javascript"},{"offset":18,"type":"identifier.js","language":"javascript"},{"offset":19,"type":"delimiter.parenthesis.js","language":"javascript"},{"offset":20,"type":"delimiter.js","language":"javascript"}]],
        {"type":"Block","token":{"line":0,"offset":0,"closingIndex":29},"statements":[{"type":"Block","token":{"line":0,"offset":0,"closingIndex":28},"statements":[{"type":"Assignment","token":{"line":0,"offset":6,"value":"="},"left":{"type":"VariableDeclaration","token":{"line":0,"offset":4,"value":"x"},"varType":3},"right":{"type":"NativeValue","token":{"line":0,"offset":8,"value":3}}},{"type":"Assignment","token":{"line":1,"offset":6,"value":"="},"left":{"type":"VariableDeclaration","token":{"line":1,"offset":4,"value":"y"},"varType":1},"right":{"type":"NativeValue","token":{"line":1,"offset":8,"value":4}}},{"type":"Assignment","token":{"line":2,"offset":8,"value":"="},"left":{"type":"VariableDeclaration","token":{"line":2,"offset":6,"value":"z"},"varType":2},"right":{"type":"NativeValue","token":{"line":2,"offset":10,"value":5}}},{"type":"FunctionCall","token":{"line":3,"offset":11,"value":"(","closingIndex":26},"func":{"type":"PropAccessStatement","token":{"line":3,"offset":7,"value":"."},"isDot":true,"left":{"type":"Variable","token":{"line":3,"offset":0,"value":"console"}},"right":{"type":38,"line":3,"offset":8,"value":"log"}},"args":[{"type":"Variable","token":{"line":3,"offset":12,"value":"x"}},{"type":"Variable","token":{"line":3,"offset":15,"value":"y"}},{"type":"Variable","token":{"line":3,"offset":18,"value":"z"}}]}],"variables":{"declaredVariables":{"x":true,"y":true,"z":true},"appearances":{"x":{"0":{"type":38,"line":0,"offset":4,"value":"x"},"1":{"type":38,"line":3,"offset":12,"value":"x"}},"y":{"0":{"type":38,"line":1,"offset":4,"value":"y"},"1":{"type":38,"line":3,"offset":15,"value":"y"}},"z":{"0":{"type":38,"line":2,"offset":6,"value":"z"},"1":{"type":38,"line":3,"offset":18,"value":"z"}},"console":{"0":{"type":38,"line":3,"offset":0,"value":"console"}}}}}],"variables":{"declaredVariables":{},"appearances":{}}}
    ],
    [
        'array',
        [" const ar = [5,2,7];",""," for (let i = 0; i < ar.length; i++) {","     console.log(ar[i]);"," }"],
        [[{"offset":0,"type":"","language":"javascript"},{"offset":1,"type":"keyword.js","language":"javascript"},{"offset":6,"type":"","language":"javascript"},{"offset":7,"type":"identifier.js","language":"javascript"},{"offset":9,"type":"","language":"javascript"},{"offset":10,"type":"delimiter.js","language":"javascript"},{"offset":11,"type":"","language":"javascript"},{"offset":12,"type":"delimiter.square.js","language":"javascript"},{"offset":13,"type":"number.js","language":"javascript"},{"offset":14,"type":"delimiter.js","language":"javascript"},{"offset":15,"type":"number.js","language":"javascript"},{"offset":16,"type":"delimiter.js","language":"javascript"},{"offset":17,"type":"number.js","language":"javascript"},{"offset":18,"type":"delimiter.square.js","language":"javascript"},{"offset":19,"type":"delimiter.js","language":"javascript"}],[],[{"offset":0,"type":"","language":"javascript"},{"offset":1,"type":"keyword.js","language":"javascript"},{"offset":4,"type":"","language":"javascript"},{"offset":5,"type":"delimiter.parenthesis.js","language":"javascript"},{"offset":6,"type":"keyword.js","language":"javascript"},{"offset":9,"type":"","language":"javascript"},{"offset":10,"type":"identifier.js","language":"javascript"},{"offset":11,"type":"","language":"javascript"},{"offset":12,"type":"delimiter.js","language":"javascript"},{"offset":13,"type":"","language":"javascript"},{"offset":14,"type":"number.js","language":"javascript"},{"offset":15,"type":"delimiter.js","language":"javascript"},{"offset":16,"type":"","language":"javascript"},{"offset":17,"type":"identifier.js","language":"javascript"},{"offset":18,"type":"","language":"javascript"},{"offset":19,"type":"delimiter.angle.js","language":"javascript"},{"offset":20,"type":"","language":"javascript"},{"offset":21,"type":"identifier.js","language":"javascript"},{"offset":23,"type":"delimiter.js","language":"javascript"},{"offset":24,"type":"identifier.js","language":"javascript"},{"offset":30,"type":"delimiter.js","language":"javascript"},{"offset":31,"type":"","language":"javascript"},{"offset":32,"type":"identifier.js","language":"javascript"},{"offset":33,"type":"delimiter.js","language":"javascript"},{"offset":35,"type":"delimiter.parenthesis.js","language":"javascript"},{"offset":36,"type":"","language":"javascript"},{"offset":37,"type":"delimiter.bracket.js","language":"javascript"}],[{"offset":0,"type":"","language":"javascript"},{"offset":5,"type":"identifier.js","language":"javascript"},{"offset":12,"type":"delimiter.js","language":"javascript"},{"offset":13,"type":"identifier.js","language":"javascript"},{"offset":16,"type":"delimiter.parenthesis.js","language":"javascript"},{"offset":17,"type":"identifier.js","language":"javascript"},{"offset":19,"type":"delimiter.square.js","language":"javascript"},{"offset":20,"type":"identifier.js","language":"javascript"},{"offset":21,"type":"delimiter.square.js","language":"javascript"},{"offset":22,"type":"delimiter.parenthesis.js","language":"javascript"},{"offset":23,"type":"delimiter.js","language":"javascript"}],[{"offset":0,"type":"","language":"javascript"},{"offset":1,"type":"delimiter.bracket.js","language":"javascript"}]],
        {"type":"Block","token":{"line":0,"offset":0,"closingIndex":42},"statements":[{"type":"Block","token":{"line":0,"offset":0,"closingIndex":41},"statements":[{"type":"Assignment","token":{"line":0,"offset":10,"value":"="},"left":{"type":"VariableDeclaration","token":{"line":0,"offset":7,"value":"ar"},"varType":2},"right":{"type":"LiteralArray","token":{"line":0,"offset":12,"value":"[","closingIndex":11},"members":[{"type":"NativeValue","token":{"line":0,"offset":13,"value":5}},{"type":"NativeValue","token":{"line":0,"offset":15,"value":2}},{"type":"NativeValue","token":{"line":0,"offset":17,"value":7}}]}},{"type":"Loop","token":{"line":2,"offset":1,"value":"for"},"initialization":{"type":"Assignment","token":{"line":2,"offset":12,"value":"="},"left":{"type":"VariableDeclaration","token":{"line":2,"offset":10,"value":"i"},"varType":1},"right":{"type":"NativeValue","token":{"line":2,"offset":14,"value":0}}},"condition":{"type":"OperationStatement","token":{"line":2,"offset":19,"value":"<"},"left":{"type":"Variable","token":{"line":2,"offset":17,"value":"i"}},"right":{"type":"PropAccessStatement","token":{"line":2,"offset":23,"value":"."},"isDot":true,"left":{"type":"Variable","token":{"line":2,"offset":21,"value":"ar"}},"right":{"type":38,"line":2,"offset":24,"value":"length"}}},"postBlock":{"type":"Assignment","token":{"line":2,"offset":33,"value":"++"},"left":{"type":"Variable","token":{"line":2,"offset":32,"value":"i"}}},"outerClosure":{"declaredVariables":{"i":true},"appearances":{"i":{"0":{"type":38,"line":2,"offset":10,"value":"i"},"1":{"type":38,"line":2,"offset":17,"value":"i"},"2":{"type":38,"line":2,"offset":32,"value":"i"}},"ar":{"0":{"type":38,"line":2,"offset":21,"value":"ar"}}}}}],"variables":{"declaredVariables":{"ar":true},"appearances":{"ar":{"0":{"type":38,"line":0,"offset":7,"value":"ar"}}}}}],"variables":{"declaredVariables":{},"appearances":{}}}
    ]
]
describe('interpreter tests', () => {
    pairs.forEach(([title, lines, lineTokens, expected]) => it(title, () => {
        const tokens = JSInterpreter.tokenize(lines, lineTokens as monaco.Token[][]);
        const interpreter = new JSInterpreter(tokens);
        expect(interpreter.top.toJSON()).toEqual(expected);
    }));
});